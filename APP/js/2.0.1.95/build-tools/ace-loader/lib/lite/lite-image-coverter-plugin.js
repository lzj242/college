"use strict";function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,r){for(var t=0;t<r.length;t++){var i=r[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,r,t){return r&&_defineProperties(e.prototype,r),t&&_defineProperties(e,t),e}var _path=require("path"),fs=require("fs"),registerRequireContextHook=require("babel-plugin-require-context-hook/register"),_require=require("./lite-enum"),REGEXP_PNG=_require.REGEXP_PNG,iconPath=process.env.iconPath||"",img2bin=require("./lite-image2bin");registerRequireContextHook();var ImageCoverterPlugin=function(){function e(r){_classCallCheck(this,e),this.options=r}return _createClass(e,[{key:"getDir",value:function(e){return global.__requireContext("",e,!0,REGEXP_PNG).keys().map(function(r){return _path.join(e,r)})}},{key:"apply",value:function(e){var r=this.options.build,t=this.getDir;e.hooks.done.tap("image coverter",function(e,i){var n=t(r),o=function(e){fs.writeFile(_path.resolve(r,"image_convert_result.txt"),e,function(e){if(e)return console.error(e)})};if(n.length>0){var a=n.map(function(e){return img2bin(e)});Promise.all(a).then(function(){o("{exitCode:0}")}).catch(function(){o("{exitCode:1}")})}else o("{exitCode:0}");""!==iconPath&&t(iconPath).forEach(function(e){img2bin(e)})})}}]),e}();module.exports=ImageCoverterPlugin;