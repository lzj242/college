var esprima=require("esprima"),estraverse=require("estraverse"),escodegen=require("escodegen");function parseExpression(e,r){const n=new RegExp("^(var\\b|while\\b|with\\b|yield\\b|enum\\b|await\\b|implements\\b|package\\b|for\\b|function\\b|if\\b|import\\b|\n    protected\\b|static\\b|interface\\b|private\\b|public\\b|break\\b|case\\b|class\\b|catch\\b|const\\b|continue\\b|debugger\\b|\n    default\\b|delete\\b|do\\b|else\\b|export\\b|extends\\b|finally\\b|in\\b|instanceof\\b|let\\b|return\\b|super\\b|switch\\b|throw\\b|try\\b)","g"),t={range:!0,tolerant:!0,jsx:!0};try{return generateCode(r?esprima.parse("("+e+")",t):esprima.parse(e,t))}catch(t){throw r?n.test(e)?Error("An event parsing error occurred. Do not use the reserved keyword: "+e).message:Error("An event parsing error occurred: "+e).message:n.test(e)?Error("A data binding parsing error occurred. Do not use the reserved keyword: "+e).message:Error("A data binding parsing error occurred: "+e).message}}function generateCode(e){const r=new RegExp("^(NaN\\b|isNaN\\b|isFinite\\b|decodeURI\\b|decodeURIComponent\\b|Math\\b|Date\\b|this\\b|true\\b|false\\b|\n    encodeURI\\b|encodeURIComponent\\b|parseInt\\b|parseFloat\\b|null\\b|undefined\\b|Infinity\\b)","g");return estraverse.traverse(e,{enter:function(e,n){if(n&&"Identifier"===e.type){let t=!1;(t=!!(["ConditionalExpression","BinaryExpression"].includes(n.type)||"CallExpression"===n.type&&n.callee===e)||("Property"===n.type&&!n.computed&&n.value===e||addPrefix(e,n)))&&!r.test(e.name)&&(e.name="this."+e.name)}}}),escodegen.generate(e,{format:{indent:{style:"",base:0,adjustMultilineComment:!1},newline:"",space:"",semicolons:!1,escapeless:!0}})}function addPrefix(e,r){const n=["expression","argument","expressions","elements","left","right"],t=["object","property","id","key"];let s=Object.keys(r);for(let t=0;t<n.length;t++)if(s.includes(n[t])&&(r[n[t]]===e||["expressions","elements"].includes(n[t])&&r[n[t]].includes(e)))return!0;for(let n=0;n<t.length;n++)if(s.includes(t[n])){if(r.computed&&r[t[n]]===e)return!0;if("Property"===r.type&&r.key.range[0]===r.value.range[0]&&r.key.range[1]===r.value.range[1])e.name=e.name+":this."+e.name;else if(r.object===e)return!0}return!1}exports.parseExpression=parseExpression;