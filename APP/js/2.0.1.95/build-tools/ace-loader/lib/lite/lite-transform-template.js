"use strict";var _optionRules;function _createForOfIteratorHelper(r){if("undefined"==typeof Symbol||null==r[Symbol.iterator]){if(Array.isArray(r)||(r=_unsupportedIterableToArray(r))){var e=0,t=function(){};return{s:t,n:function(){return e>=r.length?{done:!0}:{done:!1,value:r[e++]}},e:function(r){throw r},f:t}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,a,o=!0,c=!1;return{s:function(){n=r[Symbol.iterator]()},n:function(){var r=n.next();return o=r.done,r},e:function(r){c=!0,a=r},f:function(){try{o||null==n.return||n.return()}finally{if(c)throw a}}}}function _unsupportedIterableToArray(r,e){if(r){if("string"==typeof r)return _arrayLikeToArray(r,e);var t=Object.prototype.toString.call(r).slice(8,-1);return"Object"===t&&r.constructor&&(t=r.constructor.name),"Map"===t||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(r,e):void 0}}function _arrayLikeToArray(r,e){(null==e||e>r.length)&&(e=r.length);for(var t=0,n=new Array(e);t<e;t++)n[t]=r[t];return n}function _defineProperty(r,e,t){return e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}var _require=require("./lite-utils"),isFunction=_require.isFunction,isObject=_require.isObject,isUndefined=_require.isUndefined,_require2=require("./lite-enum"),SPECIAL_STYLE=_require2.SPECIAL_STYLE,REGEXP_NUMBER_PX=_require2.REGEXP_NUMBER_PX,REGEXP_COLOR=_require2.REGEXP_COLOR,REGEXP_UNIT=_require2.REGEXP_UNIT,REGXP_QUOTES=_require2.REGXP_QUOTES,parameterArray=[],parameter1="",parameter2="",ATTRBUTES="attrs",EVENTS_ON_FUNC="on",KEY="key",AST_KEY={ATTR:"attr",CLASSLIST:"classList",STYLE:"style",EVENTS:"events",TYPE:"type",CHILDREN:"children",KEY:"key"},optionRules=(_defineProperty(_optionRules={},AST_KEY.ATTR,function(r,e,t){return 0!==Object.keys(e.attr).length&&(r+="'".concat(ATTRBUTES,"' : ").concat(transformProps(e.attr),",")),r}),_defineProperty(_optionRules,AST_KEY.CLASSLIST,function(r,e,t){return r+=sortClass(e[t])}),_defineProperty(_optionRules,AST_KEY.STYLE,function(r,e,t){return r+=sortStyle(e[t])}),_defineProperty(_optionRules,AST_KEY.EVENTS,function(r,e,t){return r+="'".concat(EVENTS_ON_FUNC,"' : ").concat(transformEvents(e.events),",")}),_defineProperty(_optionRules,AST_KEY.KEY,function(r,e,t){return r+="'".concat(KEY,"' : ").concat(e.key,",")}),_optionRules),styleRules=[{match:function(r,e){return r===SPECIAL_STYLE.ANIMATION_DELAY||r===SPECIAL_STYLE.ANIMATION_DURATION},action:function(r,e,t){return r+="'".concat(e,"' : ").concat(JSON.stringify(t),",")}},{match:function(r,e){return r===SPECIAL_STYLE.ANIMATION_ITERATION_COUNT},action:function(r,e,t){return-1===t&&(t="infinite"),r+="'".concat(e,"' : ").concat(JSON.stringify(t),",")}},{match:function(r,e){return r===SPECIAL_STYLE.BACKGROUND_IMAGE},action:function(r,e,t){return r+="'".concat(e,"' : ").concat(checkType(t.replace(REGXP_QUOTES,"")),",")}},{match:function(r,e){return!0},action:function(r,e,t){return r+="'".concat(e,"' : ").concat(checkType(t),",")}}];function transformTemplate(r){var e=Function("return ".concat(r))(),t=isObject(e)?transformNode(e):"_c('div')";return t=t.replace(/,$/,""),"function (vm) { var _vm = vm || this; return ".concat(t," }")}function transformNode(r){return r.repeat&&!r.forCompiled?transformFor(r):r.shown&&!r.ifCompiled?transformIf(r):transformNodeDetail(r)}function transformNodeDetail(r){var e=r.type,t=transformOptions(r),n=transformChildren(r);return"_c('".concat(e,"'").concat(t?", ".concat(t," "):"").concat(n?", ".concat(n," "):"","),")}function transformOptions(r){var e="";parameter2=parameterArray[parameterArray.length-1],r.attr&&r.attr.tid&&""!==parameter2&&(r.key="".concat(parameter2,".").concat(r.attr.tid),delete r.attr.tid);for(var t=0,n=Object.keys(r);t<n.length;t++){var a=n[t];a!==AST_KEY.TYPE&&a!==AST_KEY.CHILDREN&&optionRules[a]&&(e=optionRules[a](e,r,a))}return""===e?null:e="{"+e.replace(/,$/,"")+"}"}function sortClass(r){var e="",t=checkType(r);return isFunction(r)||isUndefined(r)?e+="'".concat("dynamicClass","' : ").concat(formatForFunc(t),","):e+="'".concat("staticClass","' : ").concat(t,","),e}function sortStyle(r){for(var e="",t="",n=0,a=Object.keys(r);n<a.length;n++){var o=a[n],c=r[o];if(isFunction(c))t+="'".concat(o,"' : ").concat(formatForFunc(c),",");else for(var i=0;i<styleRules.length;i++)if(styleRules[i].match(o,c)){e=styleRules[i].action(e,o,c);break}}return""!==e&&(e="'".concat("staticStyle","' : {").concat(e.replace(/,$/,""),"}, ")),""!==t&&(t="'".concat("dynamicStyle","' :{").concat(t.replace(/,$/,""),"},")),e+t}function checkType(r){return isFunction(r)||isUndefined(r)?formatForFunc(r):isObject(r)?transformProps(r):isNaN(Number(r))?REGEXP_NUMBER_PX.test(r)?parseInt(r.replace(REGEXP_UNIT,""),10):REGEXP_COLOR.test(r)?parseInt(r.slice(1),16):"true"===r||"false"!==r&&JSON.stringify(r):Number(r)}function transformProps(r){for(var e="",t=0,n=Object.keys(r);t<n.length;t++){var a=n[t],o=r[a];"value"===a?isFunction(o)||isUndefined(o)?e+="'".concat(a,"' : ").concat(formatForFunc(r[a]),","):e+="'".concat(a,"' : ").concat(JSON.stringify(r[a]),","):e+="'".concat(a,"' : ").concat(checkType(r[a]),",")}return e="{".concat(e.replace(/,$/,""),"}")}function transformEvents(r){for(var e="",t=0,n=Object.keys(r);t<n.length;t++){var a=n[t];isFunction(r[a])?e+="'".concat(a,"' : ").concat(formatForFunc(r[a]),","):e+="'".concat(a,"' : ").concat(formatForString(r[a]),",")}return e="{".concat(e.replace(/,$/,""),"}")}function formatForString(r){var e,t=!1,n=_createForOfIteratorHelper(parameterArray);try{for(n.s();!(e=n.n()).done;){var a=e.value,o="$"===a.charAt(0)?"\\":"";if(new RegExp(o+a).test(r)){t=!0;break}}}catch(r){n.e(r)}finally{n.f()}return t?r:"_vm."+r}function transformFor(r){var e=r.repeat.exp?r.repeat.exp:r.repeat;parameterArray.push(r.repeat.key?r.repeat.key:"$idx"),parameterArray.push(r.repeat.value?r.repeat.value:"$item"),r.forCompiled=!0,e=formatForFunc(e);var t=transformNode(r).replace(/,$/,"");parameter2=parameterArray[parameterArray.length-1];var n=""!==(parameter1=parameterArray[parameterArray.length-2])&&""!==parameter2?",":"";return parameterArray.pop(),parameterArray.pop(),"_l(("+e+"),function("+parameter2+n+parameter1+"){return "+t+"}),"}function transformIf(r){r.ifCompiled=!0;var e=transformNode(r).replace(/,$/,"");return"_i(("+formatForFunc(r.shown)+"),function(){return "+e+"}),"}function formatForFunc(r){var e,t=r.toString(),n=_createForOfIteratorHelper(parameterArray);try{for(n.s();!(e=n.n()).done;){var a=e.value,o="$"===a.charAt(0)?"\\":"",c=new RegExp("this."+o+a+"\\b","g");t=t.replace(c,a)}}catch(r){n.e(r)}finally{n.f()}return t=t.replace(/this\./g,"_vm.")}function transformChildren(r){var e=r.children;if(!e)return null;for(var t="",n=0;n<e.length;n++)t+=transformNode(e[n]);return t="["+t.replace(/,$/,"")+"]"}exports.transformTemplate=transformTemplate;