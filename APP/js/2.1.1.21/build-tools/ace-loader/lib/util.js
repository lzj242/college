"use strict";function _typeof(e){"@babel/helpers - typeof";return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.getNameByPath=getNameByPath,exports.getFileNameWithHash=getFileNameWithHash,exports.getFilenameByPath=getFilenameByPath,exports.stringifyFunction=stringifyFunction,exports.logWarn=logWarn,exports.getRequireString=getRequireString,exports.stringifyLoaders=stringifyLoaders,exports.generateMap=generateMap,exports.consumeMap=consumeMap,exports.splitSourceLine=splitSourceLine,exports.printSourceWithLine=printSourceWithLine,exports.loadBabelModule=loadBabelModule,exports.parseRequireModule=parseRequireModule,exports.jsonLoaders=jsonLoaders,exports.FUNC_END_REG=exports.FUNC_END=exports.FUNC_START_REG=exports.FUNC_START=void 0;var _path=_interopRequireDefault(require("path")),_loaderUtils=_interopRequireDefault(require("loader-utils")),_hashSum=_interopRequireDefault(require("hash-sum")),_sourceMap=require("source-map"),config=_interopRequireWildcard(require("./config"));function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return _getRequireWildcardCache=function(){return e},e}function _interopRequireWildcard(e){if(e&&e.__esModule)return e;if(null===e||"object"!==_typeof(e)&&"function"!=typeof e)return{default:e};var r=_getRequireWildcardCache();if(r&&r.has(e))return r.get(e);var t={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var a=n?Object.getOwnPropertyDescriptor(e,o):null;a&&(a.get||a.set)?Object.defineProperty(t,o,a):t[o]=e[o]}return t.default=e,r&&r.set(e,t),t}function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _createForOfIteratorHelper(e){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=_unsupportedIterableToArray(e))){var r=0,t=function(){};return{s:t,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:t}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,o,a=!0,i=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return a=e.done,e},e:function(e){i=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(i)throw o}}}}function _unsupportedIterableToArray(e,r){if(e){if("string"==typeof e)return _arrayLikeToArray(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(e,r):void 0}}function _arrayLikeToArray(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var _require=require("./lite/lite-enum"),DEVICE_LEVEL=_require.DEVICE_LEVEL;function getNameByPath(e){return _path.default.basename(e).replace(/\..*$/,"")}function getFileNameWithHash(e,r){var t=_path.default.relative(".",e),n=(0,_hashSum.default)(t+r);return"./".concat(t,"?").concat(n)}function getFilenameByPath(e){return _path.default.relative(".",e)}var FUNC_START="#####FUN_S#####";exports.FUNC_START=FUNC_START;var FUNC_START_REG=new RegExp("[\"']"+FUNC_START,"g");exports.FUNC_START_REG=FUNC_START_REG;var FUNC_END="#####FUN_E#####";exports.FUNC_END=FUNC_END;var FUNC_END_REG=new RegExp(FUNC_END+"[\"']","g");function stringifyFunction(e,r){return"function"==typeof r?FUNC_START+r.toString()+FUNC_END:r}function logWarn(e,r){var t=!1;return config.logLevel>0&&r&&r.length&&r.forEach(function(r){r.reason.startsWith("NOTE")&&config.logLevel<=1?r.line&&r.column?e.emitWarning(r.reason+"\t@"+r.line+":"+r.column):e.emitWarning(r.reason):r.reason.startsWith("WARN")&&config.logLevel<=2?r.line&&r.column?e.emitWarning(r.reason+"\t@"+r.line+":"+r.column):e.emitWarning(r.reason):r.reason.startsWith("ERROR")&&config.logLevel<=3&&(t=!0,r.line&&r.column?e.emitError(r.reason+"\t@"+r.line+":"+r.column):e.emitError(r.reason))}),t}function getRequireString(e,r,t){return"require("+_loaderUtils.default.stringifyRequest(e,r?"!!".concat(r,"!").concat(t):"".concat(t))+")\n"}function stringifyLoaders(e){return e.map(function(e){if("string"==typeof e)return e;var r=e.name,t=[];if(e.query)for(var n in e.query){var o=e.query[n];null!=o&&(!0===o?t.push(n):o instanceof Array?t.push("".concat(n,"[]=").concat(o.join(","))):t.push("".concat(n,"=").concat(o)))}return"".concat(r).concat(t.length?"?"+t.join("&"):"")}).join("!")}function generateMap(e,r,t){var n=getFileNameWithHash(e.resourcePath),o=_path.default.resolve("."),a=new _sourceMap.SourceMapGenerator({sourceRoot:o,skipValidation:!0});a.setSourceContent(n,r);var i,u=_createForOfIteratorHelper(t);try{for(u.s();!(i=u.n()).done;){var l=i.value,s=l.original,c=l.generated;a.addMapping({source:n,original:s,generated:c})}}catch(e){u.e(e)}finally{u.f()}return a}function consumeMap(e,r,t){var n,o=new _sourceMap.SourceMapConsumer(t),a=[],i=[],u={};return splitSourceLine(r).forEach(function(e,r){r+=1;var t=o.originalPositionFor({line:r,column:0});t.source&&(n=t.source,a.push({line:t.line,column:t.column}),i.push({line:r,column:0}),u["line-".concat(r,"-column-").concat(0)]={line:t.line,column:t.column})}),{source:n,original:a,generated:i,mapping:u,sourcesContent:o.sourcesContent}}exports.FUNC_END_REG=FUNC_END_REG;var LINE_REG=/\r?\n/g;function splitSourceLine(e){return e.split(LINE_REG)}function printSourceWithLine(e){console.log(">>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>"),e=splitSourceLine(e).map(function(e,r){console.log(r+1+":",e)}),console.log("<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<")}function loadBabelModule(e){try{var r=require.resolve(e);return r.slice(0,r.indexOf(e.replace(/\//g,_path.default.sep))+e.length)}catch(r){return e}}function parseRequireModule(e){var r=["system.router","system.app","system.prompt","system.configuration","system.image","system.device","system.mediaquery","system.animation","system.grid"],t=e.match(/require\([^()]+?\)/g);return t&&t.length>0&&(t=t.filter(function(t){return t.indexOf("@system")>0&&(process.env.DEVICE_LEVEL===DEVICE_LEVEL.RICH&&(e=r.includes(t.replace('require("@',"").replace('")',""))?e.replace(t,t.replace("require","$app_require$").replace("@","@app-module/")):e.replace(t,t.replace(/require|@|"|\(|\)/g,"").replace("system","systemplugin"))),process.env.DEVICE_LEVEL===DEVICE_LEVEL.LITE&&(e=e.replace(t,t.replace("require","requireNative").replace("@",""))),!0)}).join("\n")),e}function jsonLoaders(e,r){var t=[];switch(e){case"template":t=[{name:_path.default.resolve(__dirname,"json.js")},{name:_path.default.resolve(__dirname,"template.js")}];break;case"style":t=[{name:_path.default.resolve(__dirname,"json.js")},{name:_path.default.resolve(__dirname,"style.js")}];break;case"json":t=[{name:_path.default.resolve(__dirname,"json.js")}]}return r&&t.push({name:_path.default.resolve(__dirname,"../node_modules/".concat(r))}),stringifyLoaders(t)}