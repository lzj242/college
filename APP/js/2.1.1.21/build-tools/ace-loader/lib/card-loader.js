"use strict";var _path=_interopRequireDefault(require("path")),_fs=_interopRequireDefault(require("fs")),_util=require("./util"),_parser=require("./parser");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function loader(e){this.cacheable&&this.cacheable();var s=(this._compiler.options.plugins[0].options.options.weex||{}).lang||{},t=this.resourcePath,i=t.replace(_path.default.extname(t).toString(),""),n="";n=(0,_util.getRequireString)(this,(0,_util.jsonLoaders)("template"),t);var r=findStyleFile(i);return 1==r.extStyle&&(n+=(0,_util.getRequireString)(this,(0,_util.jsonLoaders)("style",s[r.type]),r.styleFileName)),n=addJson(this,n,i,""),(0,_parser.parseFragment)(e).element.length&&(0,_util.logWarn)(this,[{reason:"ERROR: The custom elements is not supported."}]),n}function findStyleFile(e){var s=!1,t=e+".css",i="css";return _fs.default.existsSync(t)?(s=!0,i="css"):(t=e+".less",_fs.default.existsSync(t)?(s=!0,i="less"):(t=e+".sass",_fs.default.existsSync(t)?(s=!0,i="sass"):(t=e+".scss",_fs.default.existsSync(t)?(s=!0,i="sass"):s=!1))),{extStyle:s,styleFileName:t,type:i}}function addJson(e,s,t,i){return _fs.default.existsSync(t+".json")&&!_fs.default.existsSync(t+".js")?s+=(0,_util.getRequireString)(e,(0,_util.jsonLoaders)("json"),t+".json"+i):_fs.default.existsSync(t+".js")&&!_fs.default.existsSync(t+".json")?s+=(0,_util.getRequireString)(e,(0,_util.jsonLoaders)("json"),t+".js"+i):_fs.default.existsSync(t+".json")&&_fs.default.existsSync(t+".js")&&((0,_util.logWarn)(e,[{reason:"WARNING: '".concat(t,"' cannot have the same name files '.json' and '.js', otherwise '.json' in default.")}]),s+=(0,_util.getRequireString)(e,(0,_util.jsonLoaders)("json"),t+".json"+i)),s}module.exports=loader;